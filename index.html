<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Assistant LesFacilitateurs - Validation stricte</title>
<style>
:root{--bg:#0b1220;--card:#0f1a2b;--accent:#2563eb;--accent2:#10b981;--muted:rgba(255,255,255,0.06);}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#e6eef8;-webkit-font-smoothing:antialiased;}
#botFloat{position:fixed;right:20px;bottom:20px;width:72px;height:72px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1100;}
#botFloat img{width:60%;height:60%;}
#botBox{position:fixed;right:0;bottom:0;width:100%;max-width:420px;height:90vh;background:var(--card);border-radius:12px 12px 0 0;display:none;flex-direction:column;overflow:hidden;z-index:1200;box-shadow:0 -8px 30px rgba(0,0,0,0.6);}
#botHead{display:flex;align-items:center;gap:8px;padding:10px;background:var(--accent);}
#botHead .title{font-weight:700;}
#botBody{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;}
.premiumOptions{display:block;padding:6px;background:rgba(255,255,255,0.03);border-radius:8px;}
.premiumOption{padding:10px;border-radius:8px;background:var(--accent2);color:white;font-weight:700;cursor:pointer;margin-bottom:6px;text-align:center;}
.recordList{display:flex;flex-direction:column;gap:8px;max-height:50vh;overflow:auto;padding:6px;border-radius:8px;}
.record{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;display:flex;align-items:center;justify-content:space-between;}
.record .meta{line-height:1.1;}
.record .contact{filter:blur(6px);user-select:none;opacity:0.9;}
.record .contact.revealed{filter:none;color:var(--accent2);font-weight:700;opacity:1;}
.btn{padding:6px 8px;border-radius:6px;border:none;background:var(--accent);color:white;cursor:pointer;font-weight:700;}
.btn.pay{background:#f59e0b;}
#paymentModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1400;align-items:center;justify-content:center;}
#paymentCard{background:#122033;padding:16px;border-radius:12px;width:92%;max-width:420px;display:flex;flex-direction:column;gap:8px;}
input[type="text"], input[type="password"]{padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:white;outline:none;width:100%;}
small.note{color:#cfd8e3;opacity:0.8}
.reason{color:#ffb4b4;font-weight:700}
footer.bar{padding:10px;background:transparent;display:flex;gap:8px;align-items:center;}
@media (max-width:420px){ #botBox{right:0;left:0;width:100%;max-width:none;border-radius:12px 12px 0 0;} }
</style>
</head>
<body>

<!-- Floating open button -->
<div id="botFloat" title="Ouvrir le bot">
  <img src="https://i.ibb.co/4JH0qZt/african-head.png" alt="bot">
</div>

<!-- Bot panel -->
<div id="botBox" role="region" aria-label="Assistant LesFacilitateurs">
  <div id="botHead">
    <div class="title">ü§µüèø LesFacilitateurs</div>
    <input id="adminCode" type="password" placeholder="Code admin (cach√©)">
    <button id="adminValidateBtn" class="btn">Valider</button>
  </div>

  <div id="botBody">
    <div class="premiumOptions" aria-hidden="false">
      <div class="premiumOption" data-type="emploi">üíº Emploi</div>
      <div class="premiumOption" data-type="marketing">üìà Marketing / Visibilit√© / Pub</div>
      <div class="premiumOption" data-type="rencontre">‚ù§Ô∏è Rencontre C√©libataire</div>
      <div class="premiumOption" data-type="formation">üéì Formation</div>
    </div>

    <div id="recordsHost" class="recordList" aria-live="polite">
      <div style="opacity:0.6">S√©lectionne une option pour voir les enregistrements.</div>
    </div>
  </div>

  <footer class="bar">
    <input id="botInput" type="text" placeholder="√âcris ton message...">
    <button id="sendBtn" class="btn">Envoyer</button>
  </footer>
</div>

<!-- Payment modal -->
<div id="paymentModal" aria-hidden="true">
  <div id="paymentCard" role="dialog" aria-modal="true">
    <div><strong>üí≥ Paiement HelepMoney ‚Äî 100‚ÄØFCFA</strong></div>
    <div><small class="note">B√©n√©ficiaire: Loveline Wirnkar ‚Äî OM: 640647072 / MoMo: 676353859</small></div>

    <input id="txInput" type="text" placeholder="ID transaction ou code admin 233233" autocomplete="off">
    <div id="paymentFeedback" class="reason" style="min-height:18px"></div>

    <div style="display:flex;gap:8px;">
      <button id="confirmPaymentBtn" class="btn pay">Valider</button>
      <button id="cancelPaymentBtn" class="btn">Annuler</button>
    </div>
    <small class="note">Validation: transaction correcte ou code admin 233233. Date max 10‚ÄØminutes avant l'heure locale.</small>
  </div>
</div>

<script>
// Beneficiary & transactions
const BENEF={nom:'Loveline Wirnkar', om:'640647072', momo:'676353859'};
const now=Date.now();
const validTransactions=[
  {id:'TX1001', name:'Loveline Wirnkar', number:'640647072', timestampISO:new Date(now-3*60*1000).toISOString(), used:false},
  {id:'TX1002', name:'loveline wirnkar', number:'676353859', timestampISO:new Date(now-5*60*1000).toISOString(), used:false}
];

// Records
const records={
  emploi:[{nom:'Momo Alpha', age:28, ville:'Douala', quartier:'Bonapriso', contact:'699123456'},{nom:'Pauline Beta', age:25, ville:'Yaound√©', quartier:'Bastos', contact:'699987654'}],
  
  marketing:[{nom:'Agence X', age:'‚Äî', ville:'Douala', quartier:'Akwa', contact:'650112233'}],
  
  rencontre:[
    {nom:'celia', age:24, ville:'douala', quartier:'bonammoussadi hetero', contact:'+237 6 82 45 93 87'},
    
    {nom:'jessica', age:20, ville:'douala', quartier:'deido lesbienne', contact:'+237 6 78 38 54 23'},
    
    {nom:'naomie', age:27, ville:'douala', quartier:'pk14 hetero', contact:'+237 6 57 51 88 96'},
    
    {nom:'baddie', age:23, ville:'yaounde', quartier:'nkolmesseng bisexuelle', contact:'+237 6 56 04 31 76'},
    
    {nom:'yvanna', age:26, ville:'yaounde', quartier:' melen bisexuelle', contact:'651490863'},
    
  ],
  
  formation:[{nom:'Formation React', age:'‚Äî', ville:'Remote', quartier:'‚Äî', contact:'680998877'}]
};

// DOM
const botFloat=document.getElementById('botFloat'), botBox=document.getElementById('botBox');
const premiumBtns=document.querySelectorAll('.premiumOption');
const recordsHost=document.getElementById('recordsHost');
const paymentModal=document.getElementById('paymentModal');
const txInput=document.getElementById('txInput');
const paymentFeedback=document.getElementById('paymentFeedback');
const confirmPaymentBtn=document.getElementById('confirmPaymentBtn');
const cancelPaymentBtn=document.getElementById('cancelPaymentBtn');
const adminCodeInput=document.getElementById('adminCode');
const adminValidateBtn=document.getElementById('adminValidateBtn');

let currentSelectedRecord=null;

// ---------- Show/hide bot ----------
botFloat.addEventListener('click', () => {
  botBox.style.display = botBox.style.display === 'flex' ? 'none' : 'flex';
});

// ---------- Render records ----------
function renderRecordsFor(type) {
  recordsHost.innerHTML = '';
  const list = records[type] || [];
  if (list.length === 0) {
    const empty = document.createElement('div');
    empty.className = 'record';
    empty.textContent = 'Aucun enregistrement pour cette cat√©gorie.';
    recordsHost.appendChild(empty);
    return;
  }

  list.forEach((r, idx) => {
    const item = document.createElement('div');
    item.className = 'record';

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `<strong>${r.nom}</strong><br>${r.age ? r.age + ' ans, ' : ''}${r.ville} ‚Äî ${r.quartier || ''}`;

    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.alignItems = 'center';
    right.style.gap = '8px';

    const masked = document.createElement('span');
    masked.className = 'contact';
    masked.textContent = '*****';
    masked.style.filter = 'blur(2px)';
    right.appendChild(masked);

    const btn = document.createElement('button');
    btn.className = 'btn show';
    btn.textContent = 'Voir le num√©ro (100‚ÄØFCFA)';
    btn.onclick = () => {
      currentSelectedRecord = { type, index: idx };
      txInput.value = '';
      paymentFeedback.textContent = '';
      paymentModal.style.display = 'flex';
      paymentModal.setAttribute('aria-hidden', 'false');
      setTimeout(() => txInput.focus(), 120);
    };
    right.appendChild(btn);

    item.appendChild(meta);
    item.appendChild(right);

    item._contactSpan = masked; // store for later reveal
    recordsHost.appendChild(item);
  });
}

// ---------- Premium button click ----------
premiumBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const type = btn.dataset.type;
    renderRecordsFor(type);
  });
});

// ---------- Strict validation ----------
function normalizeText(s = '') {
  try {
    return s.normalize('NFD').replace(/\p{Diacritic}/gu, '').toLowerCase().trim();
  } catch {
    return s.replace(/[^\u0000-\u007F]/g, '').toLowerCase().trim();
  }
}
const normalizedBenef = normalizeText(BENEF.nom);

function strictValidateTx(txId) {
  if (txId === '233233') return { ok: true, method: 'admin-code' };
  if (!txId || typeof txId !== 'string') return { ok: false, reason: 'ID transaction manquant' };

  const tx = validTransactions.find(t => t.id === txId);
  if (!tx) return { ok: false, reason: 'Transaction non trouv√©e' };
  if (tx.used) return { ok: false, reason: 'Transaction d√©j√† utilis√©e' };
  if (normalizeText(tx.name) !== normalizedBenef) return { ok: false, reason: 'Nom du b√©n√©ficiaire incorrect' };
  if (tx.number !== BENEF.om && tx.number !== BENEF.momo) return { ok: false, reason: 'Num√©ro destinataire incorrect' };

  const txDate = new Date(tx.timestampISO);
  const diffMin = (Date.now() - txDate.getTime()) / (60 * 1000);
  if (diffMin > 10) return { ok: false, reason: 'Transaction trop ancienne' };

  tx.used = true;
  return { ok: true, method: 'helepmoney', tx };
}

// ---------- Payment modal ----------
confirmPaymentBtn.addEventListener('click', () => {
  const entered = txInput.value.trim();
  const res = strictValidateTx(entered);
  if (!res.ok) {
    paymentFeedback.textContent = res.reason;
    return;
  }

  if (currentSelectedRecord) {
    const domItems = Array.from(recordsHost.children);
    const dom = domItems[currentSelectedRecord.index];
    if (dom && dom._contactSpan) {
      const rec = records[currentSelectedRecord.type][currentSelectedRecord.index];
      dom._contactSpan.textContent = rec.contact;
      dom._contactSpan.classList.add('revealed');
      dom._contactSpan.style.filter = 'none';
      dom._contactSpan.style.color = '#10b981';
      dom._contactSpan.style.fontWeight = '700';
    }
  }

  paymentModal.style.display = 'none';
  paymentModal.setAttribute('aria-hidden', 'true');
  txInput.value = '';
  paymentFeedback.textContent = '';
  currentSelectedRecord = null;
});

cancelPaymentBtn.addEventListener('click', () => {
  paymentModal.style.display = 'none';
  paymentModal.setAttribute('aria-hidden', 'true');
  txInput.value = '';
  paymentFeedback.textContent = '';
  currentSelectedRecord = null;
});

// ---------- Admin code ----------
adminValidateBtn.addEventListener('click', () => {
  const code = adminCodeInput.value.trim();
  if (code === '233233') {
    Array.from(recordsHost.children).forEach(dom => {
      if (dom._contactSpan) {
        dom._contactSpan.textContent = records[dom._type]?.[dom._index]?.contact || '*****';
        dom._contactSpan.style.filter = 'none';
        dom._contactSpan.style.color = '#10b981';
        dom._contactSpan.style.fontWeight = '700';
      }
    });
    adminCodeInput.value = '';
    alert('‚úÖ Code admin valide ‚Äî contacts affich√©s');
  } else {
    alert('‚ùå Code admin invalide');
  }
});
</script>
</body>
</html>