<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lovestring - Paiement Mobile Money</title>
<style>
body {font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:20px;}
header{padding:10px 20px; background:#222; font-size:1.2rem; font-weight:bold; display:flex; justify-content:space-between;}
.carousel-container {margin:10px 0; padding:10px; border:1px solid #444; border-radius:8px;}
.carousel-title{font-weight:bold; margin-bottom:5px;}
.item{padding:8px; margin:5px 0; background:#222; border-radius:6px; display:flex; justify-content:space-between; align-items:center;}
.item:hover{background:#333;}
button{margin-left:10px;padding:5px 10px;border:none;border-radius:6px;cursor:pointer;background:#0ff;color:#000;font-weight:bold;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;}
.modal-content{background:#222;padding:20px;border-radius:12px;max-width:400px;width:90%;box-shadow:0 0 15px #0ff;text-align:center;color:#fff;}
.vendeur-box{margin-bottom:15px;padding:12px;background:#333;border:2px solid #0ff;border-radius:10px;box-shadow:0 0 12px #0ff;text-align:left;}
.vendeur-box strong{color:#0ff;}
textarea{width:100%;height:100px;margin-top:10px;border-radius:8px;padding:8px;border:none;}
#hiddenContent{margin-top:15px;}
.hidden{display:none;}
footer{padding:10px; text-align:center; margin-top:10px; border-top:1px solid #444;}
</style>
</head>
<body>

<header>🛒 ❤️ Lovestring</header>
<div id="carousels"></div>

<div id="paymentModal" class="modal hidden">
  <div class="modal-content">
    <h2>💳 Paiement Mobile Money</h2>
    <div id="vendeurInfo" class="vendeur-box"></div>
    <p>📩 Veuillez coller le message Mobile Money reçu :</p>
    <textarea id="mmMessage"></textarea>
    <button id="validateBtn">✅ Valider</button>
    <p id="paymentMsg"></p>
    <div id="hiddenContent" class="hidden"></div>
    <br>
    <button onclick="fermerModal()">↩️ Retour</button>
  </div>
</div>

<footer>© Lovestring</footer>

<script>
const vendeur = {nom:"Loveline Kinyuy Wirnkar", numeros:["676353859","695123456"]};
const carouselsDiv = document.getElementById('carousels');
let currentProduct = null;
const usedTransactions = new Set();

// Génération 10 carrousels × 5 produits
for(let c=1;c<=10;c++){
  let html = `<div class="carousel-container"><div class="carousel-title">🔥 Carrousel ${c}</div>`;
  for(let p=1;p<=5;p++){
    const id = `c${c}p${p}`;
    const title = `Produit ${c}-${p}`;
    const price = 10*c + p*5;
    const hidden = (p%2===0)?`https://exemple.com/fichier${c}${p}.pdf`:`Message secret ${c}-${p}`;
    html += `<div class="item">
      <span>✨ ${title} - XAF${price}</span>
      <button onclick="ouvrirModalProduit('${id}','${title}','${price}','${hidden}')">Voir détails / Payer</button>
    </div>`;
  }
  html += `</div>`;
  carouselsDiv.innerHTML += html;
}

// Ouvrir modal pour le produit sélectionné
function ouvrirModalProduit(id,title,price,hidden){
  currentProduct = {id,title,price,hidden};
  document.getElementById("paymentModal").classList.remove("hidden");
  document.getElementById("vendeurInfo").innerHTML =
    `<p><strong>👤 Vendeur :</strong> ${vendeur.nom}</p>
     <p><strong>📱 Numéros :</strong> ${vendeur.numeros.join(', ')}</p>
     <p><strong>💰 Montant à payer :</strong> ${price} FCFA</p>`;
  document.getElementById("mmMessage").value = '';
  document.getElementById("paymentMsg").textContent = '';
  document.getElementById("hiddenContent").classList.add("hidden");
}

function fermerModal(){ document.getElementById("paymentModal").classList.add("hidden"); }

// Validation du paiement
document.getElementById("validateBtn").addEventListener("click", ()=>{
  const msg = document.getElementById("mmMessage").value;
  const paymentMsg = document.getElementById("paymentMsg");
  const hiddenContent = document.getElementById("hiddenContent");
  if(!currentProduct) return;

  const destRegex = new RegExp(`(${vendeur.nom}|${vendeur.numeros.join('|')})`, "i");
  if(!destRegex.test(msg)){
    paymentMsg.textContent = "❌ Paiement non effectué au bon vendeur";
    return;
  }

  if(!msg.includes(currentProduct.price)){
    paymentMsg.textContent = "❌ Montant incorrect";
    return;
  }

  const dateMatch = msg.match(/le (\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/i);
  if(!dateMatch){
    paymentMsg.textContent = "❌ Date/heure introuvable";
    return;
  }
  const msgDate = new Date(dateMatch[1]);
  const now = new Date();
  if(Math.abs(now - msgDate)/60000 > 2){
    paymentMsg.textContent = "❌ Message trop ancien (>2 min)";
    return;
  }

  usedTransactions.add(currentProduct.id);
  paymentMsg.textContent = "✅ Paiement validé !";
  hiddenContent.innerHTML = currentProduct.hidden.startsWith('http') ?
    `<a href="${currentProduct.hidden}" target="_blank">📥 Télécharger le produit</a>` :
    currentProduct.hidden;
  hiddenContent.classList.remove("hidden");
});
</script>

</body>
</html>