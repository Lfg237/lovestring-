<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü§ñ Bot LesFacilitateurs</title>
<link rel="icon" href="https://raw.githubusercontent.com/Lfg237/images-Lesfacilitateurs-/3f26f24977c0505945653116dc1e37ad8c037a73/Polish_20251101_140054583.png">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg: #0b1220;
  --card: #101a30;
  --accent: #2563eb;
  --accent2: #10b981;
  --text: #e0e7ff;
  --danger: #ef4444;
}
body {
  font-family: "Poppins", sans-serif;
  margin:0; padding:0;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  align-items: center;
}
header {
  text-align: center;
  padding: 20px;
}
header img {
  width: 100px;
  border-radius: 50%;
  box-shadow: 0 0 10px var(--accent);
}
h1 {
  font-size: 1.5em;
  color: var(--accent2);
  margin-top: 10px;
}
button {
  background: var(--card);
  border: 2px solid var(--accent);
  border-radius: 12px;
  padding: 12px 20px;
  color: var(--text);
  font-size: 1em;
  margin: 8px;
  width: 80%;
  max-width: 300px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: var(--accent);
  transform: scale(1.05);
}
section {
  display: none;
  width: 90%;
  max-width: 400px;
  background: var(--card);
  border-radius: 15px;
  padding: 20px;
  margin-top: 10px;
}
input, select, textarea {
  width: 100%;
  margin: 5px 0;
  padding: 10px;
  border: none;
  border-radius: 10px;
  outline: none;
  background: #1a2438;
  color: var(--text);
}
label { font-size: 0.9em; color: #cbd5e1; }
.popup {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.85);
  align-items: center;
  justify-content: center;
  z-index:100;
}
.popup-content {
  background: var(--card);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  color: var(--text);
  max-width: 320px;
}
#catContent {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 5px;
}
.profile-card {
  background: #1a2438;
  padding: 12px;
  margin: 8px 0;
  border-radius: 12px;
}
.hidden { display: none; }
</style>
</head>
<body>
<header>
  <img src="https://raw.githubusercontent.com/Lfg237/images-Lesfacilitateurs-/3f26f24977c0505945653116dc1e37ad8c037a73/Polish_20251101_140054583.png">
  <h1>‚ô•Ô∏èlovestringüíò</h1>
</header>
rencontre au Cameroun üíñ
<div id="home">
  <button onclick="openCategory('Marketing')">üìà Marketing</button>
  <button onclick="openCategory('Rencontres')">üíû Rencontre</button>
  <button onclick="openCategory('Emplois')">üíº Emploi</button>
  <button onclick="openCategory('Trainings')">üéì Formation</button>
  <button onclick="openForm()">üìù Inscription</button>
  <button onclick="openAllProfiles()">üìã Tous les profils</button>
  <button onclick="openAdmin()">üîê Admin</button>
</div>
<section id="categorySection">
  <h2 id="catTitle">üìÇ Cat√©gorie</h2>
  <div id="catContent"></div>
  <button onclick="retourAccueil()">üîô Retour</button>
</section><section id="formSection">
  <h2>üìù Fiche d'inscription</h2>
  <form id="inscriptionForm">
    <label>Nom complet</label><input name="nom_complet" required>
    <label>√Çge</label><input name="age" type="number" required>
    <label>Ville</label>
    <select name="ville">
      <option>Yaound√©</option><option>Douala</
option><option>kribi</
option><option>Maroua</option>
      <option>Garoua</option><option>Ngaound√©r√©</option><option>Bamenda</option>
      <option>Buea</option><option>Ebolowa</option><option>Bertoua</option><option>Bafoussam</option>
    </select>
    <label>Quartier</label><input name="quartier">
    <label>Dernier dipl√¥me</label><input name="dernier_diplome">
    <label>Sexe</label><select name="sexe"><option>Homme</option><option>Femme</option></select>
    <label>Orientation sexuelle</label><select name="orientation_sexuelle">
      <option>H√©t√©ro</option><option>Homo</option><option>Bisexuel</option><option>Lesbienne</option>
    </select>
    <label>Profession</label><input name="profession">
    <label>Cat√©gorie</label><select name="categorie">
      <option>Marketing</option><option>Rencontres</option><option>Emplois</option><option>Trainings</option>
    </select>
    <label>Num√©ro de t√©l√©phone</label><input name="numero_telephone" required>
    <button type="button" onclick="ouvrirPaiement()">üí∏ S‚Äôinscrire (500 FCFA)</button>
  </form>
  <button onclick="retourAccueil()">üîô Retour</button>
</section>

<div class="popup" id="popupPaiement">
  <div class="popup-content">
    <h3>üí∞ HelepMoney</h3>
    <p>Effectue ton paiement :</p>
    <p>Loveline Wirnkar<br>MOMO :676353859 <br> BIBI OM: 656523656</p>
    <textarea id="msgTransaction" rows="4" placeholder="apr√®s le d√©p√¥t copie et Colle le message de transaction ici üëáüëá"></textarea>
    <button onclick="validerPaiement()">‚úÖ Valider</button>
    <button onclick="fermerPopup()">‚ùå Annuler</button>
  </div>
</div>
<section id="profilsSection">
  <h2 id="profilsTitle">üìã Profils</h2>
  <div id="profilsContent"></div>
  <button onclick="retourAccueil()">üîô Retour</button>
</section>

<section id="adminPanel">
  <h2>üîê Administration</h2>
  <input id="adminCode" type="password" placeholder="Entrer le code admin">
  <button onclick="checkAdmin()">Valider</button>
  <div id="adminContent"></div>
  <div id="adminTable"></div>
  <button onclick="retourAccueil()">üîô Retour</button>
</section>

<script>
const SUPABASE_URL = "https://ycotvgvevyfyqflicmtw.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inljb3R2Z3ZldnlmeXFmbGljbXR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMTQxMzIsImV4cCI6MjA3NTY5MDEzMn0.Yyod-LWZVv5t5PggZ1EZm83vgkvHgaJd2QFJe4_vMDQ";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let formData = {};

window.openCategory = async function(cat){
  document.getElementById("home").style.display="none";
  document.getElementById("categorySection").style.display="block";
  document.getElementById("catTitle").innerText = "üìÇ " + cat;
  const container = document.getElementById("catContent");
  container.innerHTML = "<p>Chargement...</p>";

  const { data, error } = await supabase.from("lesfacilitateurs").select().eq('categorie', cat);
  if(error){ container.innerHTML="<p>Erreur de chargement.</p>"; console.log(error); return;}
  if(data.length===0){ container.innerHTML="<p>Aucun profil.</p>"; return;}
  container.innerHTML="";
  data.forEach(p=>{
    const div=document.createElement("div");
    div.className="profile-card";
    div.innerHTML=`
      <b>${p.nom_complet}</b><br>
      √Çge: ${p.age}<br>
      Ville: ${p.ville}<br>
      Quartier: ${p.quartier}<br>
      Dipl√¥me: ${p.dernier_diplome}<br>
      Sexe: ${p.sexe}<br>
      Orientation: ${p.orientation_sexuelle}<br>
      Profession: ${p.profession}<br>
      Cat√©gorie: ${p.categorie}<br>
      <button onclick='voirContact("${p.id}","${p.numero_telephone}")'>üëÅÔ∏è Voir le contact (150 FCFA)</button>
    `;
    container.appendChild(div);
  });
}

window.openAllProfiles = async function() {
  document.getElementById("home").style.display = "none";
  document.getElementById("categorySection").style.display = "block";
  document.getElementById("catTitle").innerText = "üìã Tous les profils";
  await afficherTousProfils();
}

window.afficherTousProfils = async function() {
  const container = document.getElementById("catContent");
  container.innerHTML = "<p>Chargement des profils...</p>";

  const { data, error } = await supabase.from("lesfacilitateurs").select().order('created_at', { ascending: false });
  if (error) { container.innerHTML = "<p>Erreur lors du chargement des profils.</p>"; console.log(error); return; }
  if (data.length === 0) { container.innerHTML = "<p>Aucun profil enregistr√©.</p>"; return; }

  container.innerHTML = "";
  data.forEach(p => {
    const div = document.createElement("div");
    div.className = "profile-card";
    div.innerHTML = `
      <b>${p.nom_complet}</b><br>
      √Çge: ${p.age}<br>
      Ville: ${p.ville}<br>
      Quartier: ${p.quartier}<br>
      Dipl√¥me: ${p.dernier_diplome}<br>
      Sexe: ${p.sexe}<br>
      Orientation: ${p.orientation_sexuelle}<br>
      Profession: ${p.profession}<br>
      Cat√©gorie: ${p.categorie}<br>
      <button onclick='voirContact("${p.id}","${p.numero_telephone}")'>üëÅÔ∏è Voir le contact (150 FCFA)</button>
    `;
    container.appendChild(div);
  });
}

window.voirContact = function(id, numero){
  const msg = prompt("Entre le code admin ou colle ton message de transaction:");
  if(!msg) return;
  if(msg === "233233") { alert(`üìû Num√©ro : ${numero}`); return; }
  alert("‚ö†Ô∏è Paiement HelepMoney non impl√©ment√© ici."); // simplifi√©
}
</script><script>
window.openForm = function() { 
  document.getElementById("home").style.display="none"; 
  document.getElementById("formSection").style.display="block"; 
}

window.openAdmin = function() { 
  document.getElementById("home").style.display="none"; 
  document.getElementById("adminPanel").style.display="block"; 
}

window.retourAccueil = function() {
  document.getElementById("formSection").style.display="none";
  document.getElementById("adminPanel").style.display="none";
  document.getElementById("popupPaiement").style.display="none";
  document.getElementById("categorySection").style.display="none";
  document.getElementById("home").style.display="flex";
}

window.ouvrirPaiement = function() {
  formData = Object.fromEntries(new FormData(document.getElementById("inscriptionForm")).entries());
  document.getElementById("popupPaiement").style.display = "flex";
}

window.fermerPopup = function() { 
  document.getElementById("popupPaiement").style.display = "none"; 
}

window.validerPaiement = async function() {
  const msg = document.getElementById("msgTransaction").value.trim();
  if(!msg) return alert("‚ö†Ô∏è apr√®s le d√©p√¥t copie et  Colle ton message mobile money ici üëáüëá");

  formData = Object.fromEntries(new FormData(document.getElementById("inscriptionForm")).entries());
  formData.created_at = new Date().toISOString();

  if(msg === "233233") {
    await enregistrerInscription();
    alert("‚úÖ Inscription valid√©e via code admin !");
    fermerPopup();
    retourAccueil();
    return;
  }

  const lower = msg.toLowerCase();
  const validNumbers = ["676353859","656523656"];
  const validName = "loveline bibi";
  const now = new Date();
  let isRecent = false;
  const regexTime = /(\d{1,2}[:h]\d{1,2})/;
  const match = msg.match(regexTime);
  if(match){
    try{
      const [h,m] = match[1].replace("h",":").split(":").map(Number);
      const msgTime = new Date(); msgTime.setHours(h); msgTime.setMinutes(m); msgTime.setSeconds(0);
      if((now - msgTime)/60000 < 10) isRecent=true;
    }catch(e){ console.log(e); }
  }

  const isValid = validNumbers.some(n => lower.includes(n)) && lower.includes(validName) && isRecent;
  if(!isValid){ alert("‚ùå Paiement non reconnu ou expir√© !"); return; }

  await enregistrerInscription();
  alert("‚úÖ Paiement v√©rifi√© !");
  fermerPopup();
  retourAccueil();
}

async function enregistrerInscription() {
  try{
    const { data, error } = await supabase.from("lesfacilitateurs").insert([formData]).select();
    if(error){ console.error(error); alert("‚ùå Erreur lors de l'enregistrement !"); return; }
    document.getElementById("inscriptionForm").reset();
    await afficherTousProfils();
  }catch(err){ console.error(err); alert("‚ùå Exception lors de l'enregistrement !"); }
}

// --- Admin ---
window.checkAdmin = async function() {
  const code = document.getElementById("adminCode").value.trim();
  if(code !== "233233"){ alert("‚ùå Code admin incorrect !"); return; }

  const { data, error } = await supabase.from("lesfacilitateurs").select().order('created_at', {ascending:false});
  if(error){ console.error(error); alert("‚ùå Erreur lors du chargement des profils !"); return; }

  const container = document.getElementById("adminTable");
  container.innerHTML = "";
  const table = document.createElement("table");
  table.style.width="100%";
  table.style.borderCollapse="collapse";
  table.innerHTML = `
    <tr style="border-bottom:1px solid var(--accent);">
      <th>Nom</th><th>√Çge</th><th>Ville</th><th>Quartier</th>
      <th>Cat√©gorie</th><th>Actions</th>
    </tr>
  `;

  data.forEach(p=>{
    const tr = document.createElement("tr");
    tr.style.borderBottom="1px solid #2563eb";
    tr.innerHTML=`
      <td>${p.nom_complet}</td>
      <td>${p.age}</td>
      <td>${p.ville}</td>
      <td>${p.quartier}</td>
      <td>${p.categorie}</td>
      <td>
        <button onclick='modifierProfil("${p.id}")'>‚úèÔ∏è Modifier</button>
        <button style="background:var(--danger);" onclick='supprimerProfil("${p.id}", this)'>üóëÔ∏è Supprimer</button>
      </td>
    `;
    table.appendChild(tr);
  });
  container.appendChild(table);
}

window.supprimerProfil = async function(id, btn){
  if(!confirm("‚ö†Ô∏è Supprimer ce profil d√©finitivement ?")) return;
  const { error } = await supabase.from("lesfacilitateurs").delete().eq('id', id);
  if(error){ alert("‚ùå Erreur lors de la suppression"); console.log(error); return; }
  alert("‚úÖ Profil supprim√© !");
  btn.closest("tr").remove();
}

window.modifierProfil = async function(id){
  const { data, error } = await supabase.from("lesfacilitateurs").select().eq('id', id);
  if(error || data.length===0){ alert("‚ùå Impossible de r√©cup√©rer le profil"); return; }
  const p = data[0];
  document.getElementById("home").style.display="none";
  document.getElementById("formSection").style.display="block";
  const form = document.getElementById("inscriptionForm");
  form.nom_complet.value = p.nom_complet;
  form.age.value = p.age;
  form.ville.value = p.ville;
  form.quartier.value = p.quartier;
  form.dernier_diplome.value = p.dernier_diplome;
  form.sexe.value = p.sexe;
  form.orientation_sexuelle.value = p.orientation_sexuelle;
  form.profession.value = p.profession;
  form.categorie.value = p.categorie;
  form.numero_telephone.value = p.numero_telephone;

  // Remplacer l'action de l'inscription pour modifier
  const btn = form.querySelector("button[type='button']");
  btn.textContent = "üíæ Enregistrer les modifications";
  btn.onclick = async function(){
    const newData = Object.fromEntries(new FormData(form).entries());
    const { error } = await supabase.from("lesfacilitateurs").update(newData).eq('id', id);
    if(error){ alert("‚ùå Erreur lors de la modification"); console.log(error); return; }
    alert("‚úÖ Profil modifi√© !");
    form.reset();
    retourAccueil();
  }
}
</script>
</body>
</html>